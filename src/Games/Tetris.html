<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Canvas Tetris</title>
    <style>
      canvas {
        border: 2px solid black;
        display: block;
        margin: 1rem auto;
      }
      body {
        font-family: Arial, sans-serif;
        text-align: center;
      }
      .info {
        margin-top: 15px;
      }
      h1 {
        margin: 0.5rem;
      }
    </style>
  </head>
  <body>
    <h1>Tetris Game</h1>
    <canvas id="tetris" width="300" height="600"></canvas>
    <!-- Score -->
    <div class="info">
      <p>Score: <span id="score">0</span></p>
      <p>Arrow Keys: Move</p>
      <p>Up Arrow: Rotate</p>
      <p>Space: Drop</p>
    </div>
    <script>
      const canvas = document.getElementById("tetris");
      const ctx = canvas.getContext("2d");

      const ROWS = 20;
      const COLS = 10;
      const BLOCK_SIZE = 30;
      const canvasWidth = COLS * BLOCK_SIZE;
      const canvasHeight = ROWS * BLOCK_SIZE;

      canvas.width = canvasWidth;
      canvas.height = canvasHeight;

      // Draw each square on the canvas
      function drawSquare(x, y, color) {
        ctx.fillStyle = color;
        ctx.fillRect(x * BLOCK_SIZE, y * BLOCK_SIZE, BLOCK_SIZE, BLOCK_SIZE);
        ctx.strokeStyle = "white";
        ctx.strokeRect(x * BLOCK_SIZE, y * BLOCK_SIZE, BLOCK_SIZE, BLOCK_SIZE);
      }

      // Shapes and their rotations
      const SHAPES = [
        [[1, 1, 1, 1]], // I shape
        [
          [1, 1],
          [1, 1],
        ], // O shape
        [
          [0, 1, 0],
          [1, 1, 1],
        ], // T shape
        [
          [0, 1, 1],
          [1, 1, 0],
        ], // S shape
        [
          [1, 1, 0],
          [0, 1, 1],
        ], // Z shape
        [
          [1, 0, 0],
          [1, 1, 1],
        ], // L shape
        [
          [0, 0, 1],
          [1, 1, 1],
        ], // J shape
      ];

      const COLORS = [
        "cyan",
        "yellow",
        "purple",
        "green",
        "red",
        "orange",
        "blue",
      ];

      let grid = Array.from({ length: ROWS }, () => Array(COLS).fill(0));

      let currentShape = getRandomShape();
      let currentX = 3;
      let currentY = 0;
      let score = 0;
      document.getElementById("score").innerText = score;

      let gameOver = false;

      // Create random shapes
      function getRandomShape() {
        const index = Math.floor(Math.random() * SHAPES.length);
        return {
          shape: SHAPES[index],
          color: COLORS[index],
        };
      }

      // Draw the game grid
      function drawGrid() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        for (let row = 0; row < ROWS; row++) {
          for (let col = 0; col < COLS; col++) {
            if (grid[row][col] !== 0) {
              drawSquare(col, row, grid[row][col]);
            }
          }
        }
      }

      // Draw the current moving shape
      function drawCurrentShape() {
        const { shape, color } = currentShape;
        for (let row = 0; row < shape.length; row++) {
          for (let col = 0; col < shape[row].length; col++) {
            if (shape[row][col]) {
              drawSquare(currentX + col, currentY + row, color);
            }
          }
        }
      }

      // Move the shape down
      function moveDown() {
        if (!canMove(currentX, currentY + 1, currentShape.shape)) {
          placeShape();
          clearRows();
          currentShape = getRandomShape();
          currentX = 3;
          currentY = 0;
          if (!canMove(currentX, currentY, currentShape.shape)) {
            gameOver = true;
          }
        } else {
          currentY++;
        }
      }

      // Check if the shape can move to the given location
      function canMove(newX, newY, shape) {
        for (let row = 0; row < shape.length; row++) {
          for (let col = 0; col < shape[row].length; col++) {
            if (shape[row][col]) {
              const x = newX + col;
              const y = newY + row;
              if (x < 0 || x >= COLS || y >= ROWS || grid[y][x]) {
                return false;
              }
            }
          }
        }
        return true;
      }

      // Place the shape on the grid
      function placeShape() {
        const { shape, color } = currentShape;
        for (let row = 0; row < shape.length; row++) {
          for (let col = 0; col < shape[row].length; col++) {
            if (shape[row][col]) {
              grid[currentY + row][currentX + col] = color;
            }
          }
        }
      }

      // Clear rows if they are filled
      function clearRows() {
        for (let row = ROWS - 1; row >= 0; row--) {
          if (grid[row].every((cell) => cell !== 0)) {
            grid.splice(row, 1);
            grid.unshift(Array(COLS).fill(0));
            row++;
            score += 10; // Increment score for each cleared row
            document.getElementById("score").innerText = score; // Update score display
          }
        }
      }

      // Rotate the shape
      function rotateShape() {
        const rotated = currentShape.shape[0].map((_, index) =>
          currentShape.shape.map((row) => row[index]).reverse()
        );
        if (canMove(currentX, currentY, rotated)) {
          currentShape.shape = rotated;
        }
      }

      // Handle key presses for movement
      document.addEventListener("keydown", (event) => {
        if (gameOver) return;
        if (event.key === "ArrowLeft") {
          if (canMove(currentX - 1, currentY, currentShape.shape)) {
            currentX--;
          }
        } else if (event.key === "ArrowRight") {
          if (canMove(currentX + 1, currentY, currentShape.shape)) {
            currentX++;
          }
        } else if (event.key === "ArrowDown") {
          moveDown();
        } else if (event.key === "ArrowUp") {
          rotateShape();
        } else if (event.key === " ") {
          while (canMove(currentX, currentY + 1, currentShape.shape)) {
            currentY++;
          }
          placeShape();
          clearRows();
          currentShape = getRandomShape();
          currentX = 3;
          currentY = 0;
        }
      });

      // Draw the game state
      function draw() {
        drawGrid();
        drawCurrentShape();
      }

      // Game loop
      function gameLoop() {
        if (!gameOver) {
          moveDown();
          draw();
          setTimeout(gameLoop, 500);
        } else {
          alert("Game Over! Refresh to play again.");
        }
      }

      // Start the game
      gameLoop();
    </script>
  </body>
</html>
